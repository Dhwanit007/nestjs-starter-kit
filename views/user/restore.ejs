<%- contentFor('HeaderCss') %>
    <%- contentFor('body') %>
        <div>

            <!-- Flash Message Container -->
            <div id="flash-container"></div>

            <table id="deletedTable" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Deleted At</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <%- contentFor('FooterJs') %>
            <!-- Dependencies -->
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <!-- Datatables -->
            <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
            <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
            <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

            <!-- Buttons -->
            <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
            <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
            <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

            <script>
                $(document).ready(function () {
                    const table = $('#deletedTable').DataTable({
                        ajax: {
                            url: '/api/employee/deleted/list',
                            dataSrc: 'data',
                            error: function (xhr) {
                                // console.error("DataTables AJAX error:", xhr.responseText);
                            },
                        },
                        columns: [
                            { data: 'id' },
                            { data: 'name' },
                            { data: 'email' },
                            { data: 'deleted_at' },
                            {
                                data: null,
                                render: function (data) {
                                    return `
                <button class="btn btn-success btn-sm restore-btn" data-id="${data.id}">
                  Restore
                </button>
              `;
                                },
                            },
                        ],
                        pageLength: 5,
                        responsive: true,
                        columnDefs: [{
                            targets: '_all',
                            class: 'text-center'
                        }],
                    });

                    function showFlashMessage(type, message) {
                        const flashHtml = `
          <div class="flash-message alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        `;
                        $('#flash-container').html(flashHtml);

                        // Auto-dismiss after 3 seconds
                        setTimeout(() => {
                            $('.flash-message').fadeOut(500, function () {
                                $(this).remove();
                            });
                        }, 3000);
                    }

                    //  Restore employee
                    $('#deletedTable').on('click', '.restore-btn', function () {
                        const id = $(this).data('id');
                        if (confirm('Restore this employee?')) {
                            $.ajax({
                                url: '/employee/restore/' + id,
                                type: 'PATCH',
                                success: function () {
                                    showFlashMessage('success', 'Employee restored successfully!');
                                    table.ajax.reload();
                                },
                                error: function () {
                                    showFlashMessage('danger', 'Failed to restore employee.');
                                },
                            });
                        }
                    });
                });
            </script>