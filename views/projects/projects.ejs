<%- contentFor('HeaderCss') %>
    <style>
        #projectsTable_filter {
            float: right;
        }
    </style>

    <%- contentFor('body') %>
        <div>
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Projects</h5>
                    <a href="/projects/create" class="btn btn-primary">+ Add Project</a>
                </div>

                <div class="card-body">
                    <table id="projectsTable" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Sr No</th>
                                <th>Project Name</th>
                                <th>Assigned Employee</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- jQuery MUST come first -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- DataTables JS -->
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

        <!-- DataTables CSS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">


        <script>
            $(document).ready(function () {
                $('#projectsTable').DataTable({
                    processing: true,
                    serverSide: false,
                    ajax: {
                        url: "/api/projects/getall",
                        type: "GET",
                        dataSrc: function (json) {
                            return json;
                        }
                    },
                    columns: [
                        {
                            data: null,
                            render: function (data, type, row, meta) {
                                return meta.row + 1;
                            }
                        },
                        { data: "name" },
                        // {
                        //     data: "assignedEmployeeIds",
                        //     render: function (arr) {
                        //         return arr?.length || 0;
                        //     }
                        // },
                        {
                            data: "assignedEmployees",
                            render: function (employees) {
                                if (!employees || employees.length === 0) return "â€”";

                                return employees.map(e => (`<span class='ri-account-circle-line'> </span> ${e.name} <br/>`)).join(" ");
                            }
                        },
                        {
                            data: "createdAt",
                            render: function (date) {
                                return new Date(date).toLocaleDateString();
                            }
                        },
                        {
                            data: "id",
                            render: function (id) {
                                return `
                    <a href="/projects/edit/${id}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="/projects/delete/${id}" class="btn btn-sm btn-danger">Delete</a>
                `;
                            }
                        }
                    ]
                });
            })

            // $(document).ready(function () {
            //     $('#projectsTable').DataTable({
            //         processing: true,
            //         serverSide: false,
            //         ajax: {
            //             url: "/api/projects/getall",
            //             type: "GET",
            //             dataSrc: function (json) {
            //                 // ðŸ‘‡ Adjust based on your API structure
            //                 return json;
            //             }
            //         },
            //         columns: [
            //             {
            //                 data: null,
            //                 render: function (data, type, row, meta) {
            //                     return meta.row + 1;
            //                 }
            //             },
            //             { data: "projectName" },
            //             { data: "projectCode" },
            //             { data: "status" },
            //             {
            //                 data: "createdAt",
            //                 render: function (data) {
            //                     return new Date(data).toLocaleDateString();
            //                 }
            //             },
            //             {
            //                 data: "id",
            //                 render: function (id) {
            //                     return `
            //                 <a href="/projects/edit/${id}" class="btn btn-sm btn-warning">Edit</a>
            //                 <a href="/projects/delete/${id}" class="btn btn-sm btn-danger">Delete</a>
            //             `;
            //                 }
            //             }
            //         ]
            //     });
            // });
        </script>

        <%- contentFor('FooterJs') %>